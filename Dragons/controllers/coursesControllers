const Course = require('../models/course');


//courses_index, course_details, course_create_get, course_create_post, course_delete


// getting all courses to coursesIndex page
const courses_index =(req, res) => { 
    Course.find().sort({ createdAt: -1 })
       .then((result) => {
          res.render('coursesIndex', { title: 'All Courses', courses: result })//geting all courses details and send result to course Index page
       })
       .catch((err) => {
          console.log(err);
       }); 
 };


// getting add course page
 const course_create_get = (req, res) => {
    res.render('addCourse' , { title : 'Add Course'}); 
 };   


//Adding course to DB
 const course_create_post = (req, res) => {
   
    const course = new Course(req.body);
   // console.log(req.body);
    course.save()
       .then((result) => {
          res.redirect('./coursesIndex');
       })
       .catch((err) => {
          console.log(err);
       })
 };

 //Getting one course details
 const course_details = (req, res) => {
    const id = req.params.id;   
    Course.findById(id)
     .then(result => {
       res.render('courseDetails', { course: result, title: 'Course Details' });
     })
     .catch(err => {
       console.log(err);
     });
 };

 //Deleting one course
 const course_delete = (req, res) => {
   console.log(req.params);
    const id = req.params.id;
    
    Course.findByIdAndDelete(id)
      .then(result => {
        res.json({ redirect: './coursesIndex' });
      })
      .catch(err => {
        console.log(err);
      });
  };


 const course_addToSchedule_post = (req, res) => {
   console.log(req.body);
   res.redirect('./coursesIndex');
  /* students.updateOne(
      { _id: student.id },
      { $push: { scores: 89 } }
   )
       .then((result) => {
          res.redirect('./coursesIndex');
       })
       .catch((err) => {
          console.log(err);
       })*/
 };

module.exports={

    courses_index,
     course_details,
      course_create_get,
       course_create_post,
        course_delete,
        course_addToSchedule_post
}